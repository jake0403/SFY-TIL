# 6장 전송 계층 : 신뢰할 수 있는 데이터 전송하기

---

## LESSON 24. TCP의 구조

> 전송 계층에서 신뢰할 수 있는 정확한 통신을 제공하는 TCP 프로토콜의 구조에 대해 알아보자.



### 1. TCP란?

응용 계층부터 물리 계층까지 계층별로 데이터를 전달할 때 헤더를 붙이는 것을 캡슐화라고 했다.

역캡슐화는 반대로 데이터 수신 측에서 물리 계층부터 응용 계층까지 계층별로 데이터를 전달할 때 헤더를 제거하는 것이라고 했다.

전송 계층에서 TCP로 전송할 때 붙이는 헤더를 **TCP 헤더**라고 하고, 이 TCP 헤더가 붙은 데이터를 **세그먼트**(segment)라고 한다. IP 헤더와 마찬가지로 여기서는 지면이 한정되어 있어서 가로로 길게 보여주지 못하지만 실제로는 TCP 헤더도 1~11 순으로 정보가 나열되어 있다.

![TCP Header [정보통신기술용어해설]](https://lh3.googleusercontent.com/proxy/ShIebTUjPRTNe3W80HFzoFkxAXLH6ESPMNuTHABqFIGv6CYztQ3ZyDDgshtF-QkPSrfbRrV7bPxl-0tf_RsKMRGrTg)

연결형 통신은 꼼꼼하게 상대방을 확인하면서 데이터를 전송한다. 그 데이터를 전송하기 전에 해야 하는 작업이 있다.

데이터를 전송하려면 먼저 **연결**(connection)이라는 **가상의 독점 통신로**를 확보해야 한다. 이 연결을 확립한 후에 데이터를 전송할 수 있다.

![image-20210202000624192](C:\Users\이재상\AppData\Roaming\Typora\typora-user-images\image-20210202000624192.png)

먼저 그림(TCP 헤더)의 7번인 **코드 비트** 부분을 보자. 코드 비트는 TCP 헤더의 107번째 비트부터 112번째 비트까지 6비트로 연결의 제어 정보가 기록되는 곳이다.

코드 비트는 각 비트 별로 역할이 있다. 초기값은 0이고 비트가 활성화 되면 1이 된다.

연결을 확립하려면 이 중 **SYN**과 **ACK**가 필요하다. 

*  SYN = 연결 요청
*  ACK = 확인 응답

---

### 2.  3-way handshake란?

연결(connection)은 **SYN**과 **ACK**를 사용하여 확립할 수 있다. 신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전에 패킷을 교환하는데, 

![image-20210202001205571](C:\Users\이재상\AppData\Roaming\Typora\typora-user-images\image-20210202001205571.png)

다음 그림과 같이 세 번 확인한다. 이 때 연결 확립을 위해 코드 비트의 SYN과 ACK가 1로 활성화 된다.

이처럼 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것을 **3-way 핸드셰이크**라고 한다. 사람들이 상대방을 확인하고 악수를 하는 것처럼 데이터 통신에서도 확실하게 데이터가 전송되었는지 확인하면서 이루어지는 통신 수단이다.

데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야 된다.

연결을 끊을 때는 **FIN**과 **ACK**를 사용하는데, FIN은 **연결 종료**를 뜻한다. 연결을 종료할 때는 FIN과 ACK가 1로 활성화 된다.



* Lesson 24 정리
  * 전송 계층에서는 TCP 헤더가 붙는다.
  * TCP 헤더가 붙은 데이터를 세그먼트라고 한다.
  * 연결(connection)을 확립하기 위해 TCP 헤더에 있는 코드 비트를 사용한다.
  * 코드 비트 중 SYN은 연결 요청 ACK는 연결 응답, FIN은 연결 종료를 뜻한다.
  * 연결 확립을 위해 패킷 교환을 세 번 하는데 이를 3-way 핸드셰이크라고 한다.
  * 연결을 확립할 때는 SYN과 ACK를 사용하고, 연결을 종료할 때는 FIN 과 ACK를 사용한다.