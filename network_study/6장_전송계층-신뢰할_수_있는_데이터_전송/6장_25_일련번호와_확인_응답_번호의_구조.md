# 6장 전송 계층 : 신뢰할 수 있는 데이터 전송하기

---

## LESSON 25 일련번호와 확인 응답 번호의 구조

> 3-way handshake 이후 데이터 전송에 사용되는 TCP 헤더의 일련번호와 확인 응답 번호에 대해 알아보자.



### 1. 일련번호와 확인 응답 번호란?

3-way handshake가 끝나고 실제 데이터를 보내거나 상대방이 받을 때는 TCP 헤더의 **일련번호**와 **확인 응답 번호**를 사용한다.

TCP는 데이터를 분할해서 보내는데 **일련번호**는 송신 측에서 수신 측에 '이 데이터가 **몇 번째 데이터**인지' 알려주는 역할을 한다. 전송된 데이터에 일련번호를 부여하면 수신자는 원래 데이터의 **몇 번째 데이터**를 받았는지 알 수 있다.

**확인 응답 번호**는 수신 측이 **몇 번째 데이터**를 수신했는지 송신 측에 알려주는 역할을 한다. 그래서 이 번호는 다음 번호의 데이터를 요청하는데도 사용된다. 예를 들어 10번 데이터를 수신하면 11번 데이터를 송신 측에 요청하는 것이다. 이것을 **확인 응답**이라고 한다.

데이터가 항상 올바르게 전달되는 것은 아니므로 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송하게 되어 있다. 이를 **재전송 제어**라고 한다.



### 2. 윈도우 크기란?

세그먼트 하나를 보낼 때마다 확인 응답을 한 번 반환하는 통신은 효율이 높지 않다.  따라서 매번 확인 응답을 기다리는 대신 세그먼트를 연속해서 보내고 확인 응답을 반환하면 효율이 높아진다.

이렇게 연속해서 보낸 세그먼트를 저장하는 장소를 **버퍼**(Buffer)라고 한다. 이 버퍼 덕분에 세그먼트를 연속해서 보내도 수신 측은 대응할 수 있고 확인 응답의 효율 또한 높아진다.

하지만 수신 측에서 세그먼트를 대량으로 받아 데이터가 전송되면 넘치게 된다. 이것을 **오버플로우**(overflow)라고 한다.

이러한 버퍼 오버플로우가 발생하지 않도록 버퍼의 한계 크기를 알고 있어야 한다. 그것이 TCP 헤더의 **윈도우 크기**(window size) 값에 해당한다.

윈도우 사이즈는 **얼마나 많은 용량의 데이터를 저장해 둘 수 있는지**를 나타내는 것이다. 즉, 확인 응답을 일일이 하지 않고 연속해서 송수신할 수 있는 데이터의 크기이다.

이 윈도우 크기의 초깃값은 3-way handshake를 할 때 판단한다.



* Lesson 25 정리
  * 3-way handshake 이후 데이터를 전송할 때는 TCP 헤더의 일련번호와 확인 응답 번호가 사용된다.
  * 데이터를 재전송하는 것을 재전송 제어라고 한다.
  * 수신한 세그먼트(데이터)를 일시적으로 저장하는 장소를 버퍼라고 한다.
  * 데이터 크기가 버퍼 크기를 넘어서는 것을 오버플로우라고 한다.
  * 버퍼 용량의 크기를 윈도우 크기라고 한다.